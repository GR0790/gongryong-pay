<!doctype html>
<html lang="ko">
  <head>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-M2CFRWBD');</script>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>소액결제현금화, 3분 칼입금 | 24시간 상담 | 99.9% 승인 공룡페이</title>
    <style>
        /* 버튼이 비활성화(disabled) 상태일 때 회색으로 변경 */
        button:disabled {
            background-color: #ccc !important;
            cursor: not-allowed !important;
            box-shadow: none !important;
        }
        /* 체크박스 스타일 */
        .checkbox-container {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            color: #555;
            margin-bottom: 20px;
            cursor: pointer;
        }
        .checkbox-container input {
            margin-right: 8px;
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
    </style>
  </head>
  <body>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M2CFRWBD"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>

    <div id="login-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:99999; align-items:center; justify-content:center;">
        <div style="background:white; padding:30px 20px; border-radius:16px; width:85%; max-width:340px; text-align:center; box-shadow:0 10px 25px rgba(0,0,0,0.2); position:relative; font-family: sans-serif;">
            <h3 style="margin:0 0 10px 0; font-size:20px; color:#111; font-weight:800;">⚡ 3분 입금 상담 시작</h3>
            <p style="font-size:13px; color:#666; margin-bottom:20px; line-height:1.5;">
                상담 기록 유지를 위해<br>최초 1회 정보를 입력해주세요.
            </p>
            
            <div style="text-align:left; margin-bottom:8px; font-size:12px; font-weight:bold; color:#555; padding-left:4px;">이름</div>
            <input type="text" id="user-name" placeholder="예: 홍길동" style="width:100%; padding:14px; margin-bottom:15px; border:1px solid #ddd; border-radius:10px; box-sizing:border-box; font-size:15px;">
            
            <div style="text-align:left; margin-bottom:8px; font-size:12px; font-weight:bold; color:#555; padding-left:4px;">휴대폰 번호</div>
            <input type="tel" id="user-phone" maxlength="13" placeholder="010-0000-0000" oninput="autoHyphen(this)" style="width:100%; padding:14px; margin-bottom:15px; border:1px solid #ddd; border-radius:10px; box-sizing:border-box; font-size:15px;">
            
            <label class="checkbox-container">
                <input type="checkbox" id="privacy-check" onchange="checkValidation()">
                개인정보 수집 및 이용 동의 (필수)
            </label>
            
            <button id="submit-btn" onclick="submitUserInfo()" disabled style="width:100%; padding:16px; background:#22c55e; color:white; border:none; border-radius:12px; font-weight:bold; font-size:17px; cursor:pointer; box-shadow:0 4px 6px rgba(34, 197, 94, 0.2); transition: background 0.3s;">상담 시작하기</button>
            
            <button onclick="closeModal()" style="position:absolute; top:15px; right:15px; background:none; border:none; font-size:20px; color:#999; cursor:pointer;">&times;</button>
        </div>
    </div>

    <script>
      (function(){var w=window;if(w.ChannelIO){return w.console.error("ChannelIO script included twice.");}var ch=function(){ch.c(arguments);};ch.q=[];ch.c=function(args){ch.q.push(args);};w.ChannelIO=ch;function l(){if(w.ChannelIOInitialized){return;}w.ChannelIOInitialized=true;var s=document.createElement("script");s.type="text/javascript";s.async=true;s.src="https://cdn.channel.io/plugin/ch-plugin-web.js";var x=document.getElementsByTagName("script")[0];if(x.parentNode){x.parentNode.insertBefore(s,x);}}if(document.readyState==="complete"){l();}else{w.addEventListener("DOMContentLoaded",l);w.addEventListener("load",l);}})();

      // [핵심 1] 자동 로그인 체크
      var savedPhone = localStorage.getItem('grpay_phone');
      var savedName = localStorage.getItem('grpay_name');

      if (savedPhone) {
          ChannelIO('boot', {
            "pluginKey": "66c596c9-3225-4678-b746-0c024efd6f01",
            "memberId": savedPhone,
            "profile": { "name": savedName, "mobileNumber": savedPhone }
          });
      } else {
          ChannelIO('boot', { "pluginKey": "66c596c9-3225-4678-b746-0c024efd6f01" });
      }

      // [기능 1] 전화번호 자동 하이픈 (-) 추가 및 검사
      window.autoHyphen = function(target) {
          // 숫자만 남기기
          var rawValue = target.value.replace(/[^0-9]/g, '');
          var formatted = '';

          // 010-XXXX-XXXX 형식 만들기
          if(rawValue.length < 4) {
              formatted = rawValue;
          } else if(rawValue.length < 8) {
              formatted = rawValue.substr(0, 3) + '-' + rawValue.substr(3);
          } else if(rawValue.length < 12) {
              formatted = rawValue.substr(0, 3) + '-' + rawValue.substr(3, 4) + '-' + rawValue.substr(7);
          } else {
              formatted = rawValue.substr(0, 3) + '-' + rawValue.substr(3, 4) + '-' + rawValue.substr(7, 4);
          }
          
          target.value = formatted;
          checkValidation(); // 입력할 때마다 검사 실행
      }

      // [기능 2] 유효성 검사 (번호 형식 + 동의 체크)
      window.checkValidation = function() {
          var phone = document.getElementById('user-phone').value;
          var isChecked = document.getElementById('privacy-check').checked;
          var submitBtn = document.getElementById('submit-btn');

          // 정규식: 010-0000-0000 형식인지 확인 (총 13자리)
          var phoneRegex = /^010-\d{4}-\d{4}$/;

          if (phoneRegex.test(phone) && isChecked) {
              submitBtn.disabled = false; // 조건 만족 시 활성화 (초록색)
          } else {
              submitBtn.disabled = true;  // 조건 불만족 시 비활성화 (회색)
          }
      }

      // 팝업 열기
      window.startConsult = function() {
          var checkPhone = localStorage.getItem('grpay_phone');
          if (checkPhone) {
              ChannelIO('showMessenger');
          } else {
              document.getElementById('login-modal').style.display = 'flex';
          }
      }

      // 팝업 닫기
      window.closeModal = function() {
          document.getElementById('login-modal').style.display = 'none';
      }

      // 정보 제출
      window.submitUserInfo = function() {
          var name = document.getElementById('user-name').value.trim();
          var phone = document.getElementById('user-phone').value.trim();
          var isChecked = document.getElementById('privacy-check').checked;

          // 한번 더 방어막 (버튼이 활성화되어 있어도 검사)
          if (!name || !isChecked || phone.length !== 13) {
              alert('정보를 정확히 입력해주세요.');
              return;
          }

          var cleanPhone = phone.replace(/-/g, ''); // 하이픈 제거 후 저장

          localStorage.setItem('grpay_name', name);
          localStorage.setItem('grpay_phone', cleanPhone);

          ChannelIO('shutdown');
          setTimeout(function(){
              ChannelIO('boot', {
                  "pluginKey": "66c596c9-3225-4678-b746-0c024efd6f01",
                  "memberId": cleanPhone,
                  "profile": { "name": name, "mobileNumber": cleanPhone }
              }, function(error, user) {
                  closeModal();
                  ChannelIO('showMessenger');
              });
          }, 100);
      }
    </script>
  </body>
</html>
